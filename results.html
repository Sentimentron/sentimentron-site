<!DOCTYPE html>
<!-- saved from url=(0030)http://www.sentimentron.co.uk/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

	<title>Sentimentron</title>

	<script src="assets/jquery-1.9.1.min.js"></script>
	<script src="assets/jquery.event.drag-2.2.js"></script>
	<script src="flot/jquery.flot.js"></script>
	<script src="flot/jquery.flot.stack.js"></script>
	<script src="flot/jquery.flot.axislabels.js"></script>
	<script src="flot/jquery.flot.autoscaling.js"></script>
	<script src="flot/jquery.flot.navigate.js"></script>

	<link rel="stylesheet" type="text/css" href="./assets/style.css">

	<script>

		// Utility functions
		function chooseRandomElem(of) {
			var length = of.length;
			var rand   = Math.floor((Math.random() * length)-0.00001);
			return of[rand];
		}

	</script>

	<script>

		//
		// This script should be used for RPC testing
		//

		var resultTestFiles = [
			"samples/foxnews.json",
			"samples/obama.json",
			"samples/foxnews_democrat.json",
			"samples/apple_computer.json",
			"samples/guardian.json"
		];

		var resultTestFiles = ['samples/foxnews_democrat.json'];

		var extraTestFiles = [
			"samples/extra_headline.json",
			"samples/extra_noheadline.json"
		]

		function getResultURL() {
			return chooseRandomElem(resultTestFiles);
		}

		function getExtraURL() {
			return chooseRandomElem(extraTestFiles);
		}

	</script>

	<script>

	var showingCumulative  = false; 
	var showingLogarithmic = false;
	var showOnlyRelevant   = false;

	var UIshowRelevantPanel = false;

	var displayItem = "volume";
	var displayMode = "line";
	var displayElem = "volume";

	// General AJAX functions to make the application more responsive
	$().ajaxStart(function(){
	   $('body').css('cursor', 'wait');
	});

	$().ajaxStop(function(){
	   $('body').css('cursor', 'auto');
	});

	var sortFunc = function(a, b) {
		a = a[0]; b = b[0];
		if (a > b) return  1;
		if (a < b) return -1;
		return 0;
	};

	var negativeMapFunc = function(a) {
		return [a[0], -a[1]];
	};

	function convert_singletonDict(data) {
		ret = []
		$.each(data, function(k) {
			ret.push([parseInt(k), data[k]])
		});
		return ret; 
	}

	function accumulate(data) {
		ret = [], accum = 0
		$.each(data, function(k) {
			if(showingCumulative)
				accum += data[k][1]
			else
				accum = data[k][1]
			if(showingLogarithmic)
				pushVal = Math.log(accum+0.0001)/Math.log(10)
			else
				pushVal = accum
			ret.push([data[k][0], pushVal])
		});
		return ret;
	}

	function UI_prepareData_volume(data) {
		var ret_crawled = {}; ret_certain = {}; ret_uncertain = {};
		$.each(data, function(t) {
			$.each(data[t], function(d) {
				ret = null;
				if(data[t][d].date_method == "Crawled")
					ret = ret_crawled
				if(data[t][d].date_method == "Certain")
					ret = ret_certain
				if(data[t][d].date_method == "Uncertain") {
					ret = ret_uncertain
				}
				if(t in ret) {
					ret[t] = ret[t] + 1;
				}
				else {
					ret[t] = 1;
				}
			})
		});

		var cnv = convert_singletonDict;

		ret_crawled = cnv(ret_crawled).sort(sortFunc)
		ret_certain = cnv(ret_certain).sort(sortFunc)
		ret_uncertain = cnv(ret_uncertain).sort(sortFunc)

		ret_crawled = accumulate(ret_crawled);
		ret_certain = accumulate(ret_certain);
		ret_uncertain = accumulate(ret_uncertain);

		ret = [] 
		if (ret_crawled.length > 0) {
			ret.push({
				label: "Crawled",
				data : ret_crawled
			});
		}
		if (ret_certain.length > 0) {
			ret.push({
				label: "Certain",
				data : ret_certain
			});
		}
		if (ret_uncertain.length > 0) {
			ret.push({
				label: "Uncertain",
				data : ret_uncertain
			});
		}
		return ret;
	}

	function UI_prepareData_docProperty(data, prefix) {
		var ret = {}
		$.each(data, function(t) {
			$.each(data[t], function(d){
				rec = data[t][d]
				attr = rec[prefix]
				if(t in ret) {
					ret[t] += attr;
				} else {
					ret[t] = attr;
				}
			});
		});

		return convert_singletonDict(ret).sort(sortFunc);
	}

	function UI_prepareData_docLabel(data, label) {
		var ret = {}
		$.each(data, function(t) {
			$.each(data[t], function(d){
				rec = data[t][d]
				if (rec['label'] == label) {
					if(t in ret) {
						ret[t] += 1;
					}
					else {
						ret[t]  = 1;
					}
				}
			});
		});
		return convert_singletonDict(ret).sort(sortFunc);
	}

	function UI_showAdditionalDataPanel(identifier, information) {
		var addPanel = $("#additionalPanel");
		var panelTemplate = $('<p><a class="originalUrl"/><br /><a class="archivedUrl">Archived link &gt;</a></p>');

		// If it's got a headline, make sure we show it
		var headline = information['headline'];
		var headlineElem = null;
		if(headline != null) {
			headlineElem = $('<h2 class="headline" />');
			headlineElem.text(headline);
		}

		// Display the original URL and archived url
		var origLink = panelTemplate.children('.originalUrl');
		origLink.attr("href","http://"+information.url);

		var archiveLink = panelTemplate.children('.archivedUrl');
		archiveLink.attr("href","http://"+information.archive_link);

		// Generate a snippet of the URL to display 
		var origUrl = information.url;
		if (origUrl.length > 32) {
			var urlArray = origUrl.split("/");
			var newUrl   = urlArray[0] + "/.../" + urlArray[urlArray.length-1];
			origLink.text(newUrl);
		}
		else {
			origLink.text(origUrl);
		}

		var panelDiv = $('<div />');
		if(headlineElem != null) {
			//headlineElem.append(panelTemplate);
			panelDiv.html(headlineElem);
			panelDiv.append(panelTemplate);
		}
		else {
			panelDiv.html(panelTemplate);
		}
		addPanel.append(panelDiv);
	}

	function UI_showAdditionalData(plotX, plotIdentifiersData) {
		var relevantData; 
		
		// Make sure we're at a valid offset
		plotX = Math.round(plotX);

		// Retrieve data subset
		relevantData = plotIdentifiersData[plotX];
		if (relevantData == null) {
			return;
		}

		// Retrieve the identifiers
		identifiers = []
		$.each(relevantData, function(t) {
			var record = relevantData[t];
			identifiers.push(record.id);
		});

		// Locate the additional information panel 
		var addPanel = $("#additionalPanel");
		addPanel.html("<p>Loading...</p>");
		var cleared = false;

		$.each(identifiers, function(i){
			$.ajax({
			"dataType": "json",
			"url": getExtraURL(),
			"success": function(response) {
				if(!cleared) {
					addPanel.html("");
					cleared = true;
				}
				UI_showAdditionalDataPanel(i, response);
			},
			"error": function() {
				addPanel.html("<p>There was a problem loading additional information.</p>")
			}
		})
		})
	}

	function _UI_plotSection_docPrp(sectionTitle, plotAreaTitle, originalData) {

		// Get the plot area
		var plotSection = $("#"+sectionTitle);
		var plotArea = plotSection.children(".plotArea");

		var data;
		if('docs' in originalData) {
			data = originalData.docs; 
		}
		else {
			data = originalData;
		}

		// Compute the data
		// UI_prepareData_docProperty(data, prefix) 
		var prefix = "pos_" + displayElem;
		if(displayElem == "phrases" && showOnlyRelevant) {
			prefix += "_rel";
		}
		var positiveAxis = null, negativeAxis = null;
		if(displayElem == "documents")  {
			positiveAxis = UI_prepareData_docLabel(data, 1);
			negativeAxis = UI_prepareData_docLabel(data,-1);
		}
		else {
			positiveAxis = UI_prepareData_docProperty(data, prefix);
			var prefix = "neg_" + displayElem;
			if(displayElem == "phrases" && showOnlyRelevant) {
				prefix += "_rel";
			}
			negativeAxis = UI_prepareData_docProperty(data, prefix);
		}
		negativeAxis = negativeAxis.map(negativeMapFunc);

		var yAxisLabel = displayElem;
		if(showingCumulative) {
			positiveAxis = accumulate(positiveAxis);
			negativeAxis = accumulate(negativeAxis);
		}

		var data = [positiveAxis, negativeAxis]

		var plotOptions = {
			grid: {
				clickable: true,
				hoverable: true
			},
			points: {
				show: true
			},
			bars: {
				show: !showingCumulative
			},
			lines : {
				show: showingCumulative
			},
			xaxis: {
				mode: 'time',
		        axisLabel: 'Date',
	            axisLabelUseCanvas: true,
	            axisLabelFontSizePixels: 10,
	            axisLabelFontFamily: 'Arial',
	            min: 933430400000
	  			},
			yaxis: {
				axisLabel: yAxisLabel,
            	axisLabelUseCanvas: true,
            	axisLabelFontSizePixels: 10,
            	autoscale: true,
			},	
			zoom: {
            	interactive: true
        	},
        	pan: {
            	interactive: true
        	},
        	colors: ['#99BBBB','#FFBBBB']
		}

		// Fix for weird stacking behaviour
		if(!showingCumulative) {
			plotOptions['series'] = {}
			plotOptions['series']['stacked'] = true;
		}

		// Plot the graph
		$.plot("#"+plotAreaTitle, data, plotOptions);

		// Register for additional data services
		var dragging = false;
		$("#"+plotAreaTitle).bind("plotclick", function(event, pos, item) {
			if (item && !dragging) {
				positionX = item.datapoint[0]
		    	UI_showAdditionalData(positionX, originalData);
		    }
		});

		// These functions must be defined for some reason
		$('#'+plotAreaTitle + " canvas").bind('dragstart', function() {
			dragging = true;
		});
		$('#'+plotAreaTitle + " canvas").bind('dragend', function() {
			setTimeout(function() {dragging = false;}, 100);
		});
		$('#'+plotAreaTitle + " canvas").bind('plotzoom', function(event, plot){});
	}

	function _UI_plotSection_volume(sectionTitle, plotAreaTitle, originalData){

		// Create the div which contains the plot
		var plotSection = $("#"+sectionTitle);

		// Create the plotArea and append it to the div
		var plotArea = plotSection.children(".plotArea");

		var data;
		if('docs' in originalData) {
			data = originalData.docs; 
		}
		else {
			data = originalData;
		}

		data = UI_prepareData_volume(data);

		// Plot the data

		var yAxisLabel = "Articles / Day"
		if(showingCumulative) {
			yAxisLabel = "Total Articles"
		}
		if(showingLogarithmic) {
			yAxisLabel += " (log scale)"
		}

		var yAxisTicks = null;


		var plotOptions = {
			grid: {
				clickable: true,
				hoverable: true
			},
			points: {
				show: true
			},
			bars: {
				show: !showingCumulative
			},
			lines : {
				show: showingCumulative
			},
			xaxis: {
				mode: 'time',
		        axisLabel: 'Date',
	            axisLabelUseCanvas: true,
	            axisLabelFontSizePixels: 10,
	            axisLabelFontFamily: 'Arial',
	            min: 933430400000
	  			},
			yaxis: {
				axisLabel: yAxisLabel,
            	axisLabelUseCanvas: true,
            	axisLabelFontSizePixels: 10,
            	autoscale: false,
            	panRange: [0, 1000000000000]
			},	
			zoom: {
            	interactive: true
        	},
        	pan: {
            	interactive: true
        	}
			//'colors': ['#99BBBB','#FFBBBB']
		}

		if(!showingCumulative) {
			plotOptions['series'] = {}
			plotOptions['series']['stacked'] = true;
		}

		$.plot("#"+plotAreaTitle, data, plotOptions);
		var dragging = false;
		$("#"+plotAreaTitle).bind("plotclick", function(event, pos, item) {
			if (item && !dragging) {
				positionX = item.datapoint[0]
		    	UI_showAdditionalData(positionX, originalData);
		    }
		});

		$('#'+plotAreaTitle + " canvas").bind('dragstart', function() {
			dragging = true;
		});
		$('#'+plotAreaTitle + " canvas").bind('dragend', function() {
			setTimeout(function() {dragging = false;}, 100);
		});
		$('#'+plotAreaTitle + " canvas").bind('plotzoom', function(event, plot){});
	}

	var plotSectionCounter = 0;
	var plotAreaInformation = {}

	function _UI_plotSection_additional(sectionTitle, originalData) {
		// Find the div which contains the plot
		var plotSection = $("#"+sectionTitle);

		// Display the additional details table 
		var additionalTable = plotSection.find(".detailsTable");
		additionalTable.show();
			
	}

	function UI_plotSection(sectionId) {
		sectionTitle = "plotSection"+(sectionId+1);
		plotAreaTitle = "plotArea" + (sectionId+1);
		console.log(plotAreaInformation);
		data = plotAreaInformation[sectionId];
		console.log("UI_plotSection");
		console.log(data);

		if(displayElem == "volume")
			_UI_plotSection_volume(sectionTitle, plotAreaTitle, data);
		else
			_UI_plotSection_docPrp(sectionTitle, plotAreaTitle, data);

		if('docs' in data) {
			_UI_plotSection_additional(sectionTitle, data);
		}
	}

	function UI_addPlotSection(title, data) {
		plotSectionCounter++;
		// Create the scaffold
		var plotSectionDiv = $("<div class=\"panel resultsPanel\"><h1 class=\"siteThing\"/><center><table class=\"detailsTable\"><tr><th>Coverage estimate</th><th>Site links</th></tr><tr><td><p class=\"coverageParagraph\"><span class=\"coverageInfo\">58</span>&#37;</p></td><td rowspan=\"2\"><div class\"linkPlot\" /></td></tr><tr><td>barack obama, hillary clinton</td></table></center><div class=\"plotAreaPadding\"><div class=\"plotArea\"></div></div>");

		// Update the section title
		var plotSectionTitle = plotSectionDiv.find('h1');
		plotSectionTitle.text(title)

		console.log("UI_addPlotSection");
		console.log(data);

		// Find the scaffold's plotArea div
		var plotArea = plotSectionDiv.find('.plotArea');

		// Update the scaffold identifiers
		plotSectionDiv.attr("id", "plotSection"+plotSectionCounter);
		plotArea.attr("id", "plotArea"+plotSectionCounter);

		// Append to results section
		var appendTo = $(document).find("#resultsSection");
		appendTo.append(plotSectionDiv);

		// Update internal records 
		plotAreaInformation[plotSectionCounter-1] = data
	}


	function UI_plotCharts() {

		// Read form values
		showingCumulative = false;
		showingLogarithmic = false;
		showOnlyRelevant = false;
		if($('#cumulativeCheck').is(':checked')) {
			showingCumulative = true;
		}
		if($('#logCheck').is(':checked')) {
			showingLogarithmic = true;
		}
		if($('#relevantCheck').is(':checked')) {
			showOnlyRelevant = true;
		}

		for(i = 0; i < plotSectionCounter; i++) {
			UI_plotSection(i);
		}
	}

	var RPC_consumeInput = function(data){
	   $('html').addClass('busy');
		var infoSection = data.info;
		if(!('result_version' in infoSection) || infoSection.result_version != '1') {
			alert("Unsupported result format.");
			return;
		} 
		var overviewSection = data.overview;
		UIshowRelevantPanel = infoSection.using_keywords;

		UI_addPlotSection("Overview", overviewSection);

		console.log("RPC_consumeInput");
		$.each(data.details, function(index, item){
			console.log([index,item]);
			UI_addPlotSection(index, item);
		})

		UI_plotCharts();
	   $('html').removeClass('busy');

		//UI_plotSection("Overview", overviewSection);
	}

	$(document).ready(function() {

		$('html').addClass('busy');

		$("input[type='checkbox']").change( function() {
			UI_plotCharts();
		});

		$("input[type='radio']").change( function () {
			displayElem = $(this).val();
			if(displayElem == "phrases") {
				if(UIshowRelevantPanel) {
					$("#relevantTable").show();
				}
			}
			else {
				$("#relevantTable").hide();
			}
			UI_plotCharts();
		});

		// Display the main page body 
		$("#wrapper").show();

		// Load the result data...
		$.ajax({
			"url": getResultURL(),
			"dataType": "json",
			"success": function(response) {
				RPC_consumeInput(response);
				UI_plotCharts();
			},
			"error": function() {
				alert("error")
			}
		})

	});

	$(function(){  
	  $("html").bind("ajaxStart", function(){  
	     $(this).addClass('busy');  
	   }).bind("ajaxStop", function(){  
	     $(this).removeClass('busy');  
	   });  
	});

	</script>

	<style type="text/css">
	html.busy, html.busy * {  
	  cursor: wait !important;  
	}  
	.panel {
		background: rgba(54, 54, 54, 0.9);
		width:200px;
		padding:15px;
		margin-left:5px;
		margin-top:10px;
		font-size: 10px;
	}

	.overviewPanel {
		min-width: 580px;
		width: 90%;
	}

	.resultsPanel {
		width:680px;
	}

	.sitePanel {
		width:500px;
	}

	.panel h1 {
		font-size: 20px;
		margin: 0px;
		margin-bottom:15px;
	}

	.panel h2 {
		font-size: 17px;
		/*font-variant: small-caps;	*/
		margin: 0px;
		margin-bottom:15px;
	}

	.panel table {
		text-align: left;
	}

	.panel th {
	}

	.panel ul {
		margin: 0px;
		padding: 0px;
		list-style-type: none;
	}

	.panel li {
		width:150px;
	}

	.panel label {
		text-align: right;
		width: 156px;
	}

	.stat {
		font-size: 16px;
	}

	.plotAreaPadding {
		background-color: white; 
		padding: 15px;
	}

	.plotArea {
		height:400px;
		background-color:white;
	}

	.radioTable {
	}
	.radioTable th {
		text-align: left;
	}
	.radioTable td {
		text-align: left;
	}

	.checkColumn {
		width: 37px;
	}

	.detailsTable {
		width:100%;
		display:none;
	}

	</style>
</head>

<body>

	<noscript>
		<div>
			<h1>Javascript error</h1>
			<p>Sentimentron needs Javascript enabled so it can show you graphs. </p>
		</div>
	</noscript>

	<div id="wrapper" style="display:none">

	<div id="header">

		<img id="logo" src="./assets/Sentimentron.png">

		<p><a href="http://www.sentimentron.co.uk/about.html">About</a></p>
		<p><a href="http://www.sentimentron.co.uk/about.html">Stats</a></p>

		<div id="header-search-form">

			<form>
				<input type="text">
				<img id="search-mag" src="./assets/magnifier.png">
			</form>

		</div>

	</div>

	<table style="width: 100%">

		<tr><td style="width: 230px" valign="top">

			<div id="controlPanel" class="panel">
				<form id="controlForm">

					<table style="text-align:left; width: 100px">
						<tr><td class="checkColumn"><input type="checkbox" name="cumulativeCheck" checked="checked" id="cumulativeCheck"/></td><td><label for="cumulativeCheck">Cumulative</label></td></tr>
						<tr><td class="checkColumn"><input type="checkbox" disabled="disabled" name="logCheck" id="logCheck" /></td><td><label for="logCheck">Log scale</label></td></tr>
					</table>
						<table style="width:60%;" class="radioTable">
							<tr><th>Points</th><th>Blobs</th></tr>
							<tr><td><input type="radio" name="displayRadio" value="lines" /></td><td><input type="radio" name="displayRadio" value="dots" /></td></tr>
						</table>
						<table id="lineOptionsTable" class="radioTable">
							<tr><th>Documents</th><th>Sentences</th><th>Phrases</th><th>Volume</th></tr>
							<tr>
								<td><input type="radio" name="lineRadio" value="documents" /></td>
								<td><input type="radio" name="lineRadio" value="sentences"   /></td>
								<td><input type="radio" name="lineRadio" value="phrases" /></td>
								<td><input type="radio" name="lineRadio" value="volume" checked="checked"/></td>
							</tr>
						</table>
						<table style="text-align:left; width: 100%; display:none" id="relevantTable">
							<tr><td class="checkColumn"><input type="checkbox" name="relevantCheck" id="relevantCheck"/></td><td style="text-align:left"><label for="relevantCheck">Relevant phrases</label></td></tr>
						</table>
				</form>
			</div>
				<div id="queryPanel" class="panel">
				<p><span class="stat">2000</span> articles retrieved</p>
				<p><span class="stat">2</span> subdomains retrieved</p>
				<p><span class="stat">47</span> keywords resolved</p>
				<hr />
				<p><span class="stat">4.7s</span> execution time</p>
				<hr />
				<p><span class="stat">1450</span> documents analysed</p>
				<p><span class="stat">15 321</span> sentences analysed</p>
				<p><span class="stat">47 231</span> phrases analysed</p>
				<hr />
				<h1>Keyword expansions</h1>
				<p>President Barack Obama, Barack, Obama, Barack Obama, President</p>
			</div>
		</td><td valign="top" id="resultsSection">


			</div>
		</td><td valign="top" style="width: 230px" id="additionalSection">

		<div id="additionalPanel" class="panel" style="float:right">

			<div>
			<h2>Obama campaign "Doomed to fail" say experts</h2>
			<p> <a href="http:///asdfasdfasdsda.com">http://something.com/.../dt;s32.html</a>
				<a href="http://archive.org">Archived Link &gt;</a></p>
				<hr />
			</div>
			<div>
			<h2>Troubled Obama campaign riven by scandal</h2>
			<p> <a href="http:///asdfasdfasdsda.com">http://something.com/.../0t;ss2.html</a>
				<a href="http://archive.org">Archived Link &gt;</a></p>
			</div>
		</div>

	</td></tr></table>


</body></html>